using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace BikeTheT
{
    public class BikeTheTService
    {
        public bool BikesAllowedOnCommuterRailTrain(string trainNum)
        {
            return TrainsWithBikesAllowed.Contains(trainNum);
        }

        public bool BikesAllowedOnSubway(string color, string direction, DateTime timeOfTravel, bool? isWeekend)
        {
            var answer = false;
            if (color.Equals("green") || color.Equals("mattapan"))
            {
                answer = false;
            }

            else if ((isWeekend.HasValue && isWeekend.Value) || IsWeekend(timeOfTravel))
            {
                answer = true;
            }
            else
            {
                var relevantEmbargoedHours = EmbargoedHours.Where(e => e.Item1.Equals(color) && e.Item2.Equals(direction));

                answer = relevantEmbargoedHours == null ||
                    relevantEmbargoedHours.All(t => !IsInTimeRange(timeOfTravel, t.Item3, t.Item4));

            }

            return answer;
        }

        private bool IsWeekend(DateTime timeOfTravel)
        {
            return (timeOfTravel.DayOfWeek == DayOfWeek.Saturday) || (timeOfTravel.DayOfWeek == DayOfWeek.Sunday);
        }

        private bool IsInTimeRange(DateTime timeOfTravel, int startHour, int endHour)
        {
            return startHour <= timeOfTravel.Hour && timeOfTravel.Hour <= endHour;
        }

        private IEnumerable<string> TrainsWithBikesAllowed = new string[]
        {
            "002",
            "003",
            "005",
            "007",
            "009",
            "012",
            "014",
            "015",
            "016",
            "018",
            "020",
            "022",
            "027",
            "028",
            "029",
            "033",
            "041",
            "048",
            "051",
            "052",
            "055",
            "056",
            "057",
            "060",
            "061",
            "062",
            "063",
            "064",
            "065",
            "066",
            "070",
            "071",
            "073",
            "075",
            "077",
            "079",
            "080",
            "082",
            "084",
            "086",
            "088",
            "090",
            "091",
            "092",
            "093",
            "100",
            "1001",
            "1002",
            "1003",
            "1004",
            "1005",
            "1006",
            "1007",
            "1008",
            "1009",
            "101",
            "1010",
            "1011",
            "1012",
            "1013",
            "1014",
            "1015",
            "1016",
            "103",
            "1032",
            "1033",
            "1034",
            "1035",
            "1036",
            "1037",
            "1038",
            "1039",
            "1040",
            "1041",
            "105",
            "1051",
            "1052",
            "1053",
            "1054",
            "1055",
            "1056",
            "107",
            "1070",
            "1071",
            "1072",
            "1073",
            "1074",
            "1075",
            "1076",
            "1077",
            "1078",
            "1079",
            "1080",
            "1081",
            "1082",
            "1083",
            "1084",
            "1085",
            "109",
            "110",
            "1100",
            "1101",
            "1102",
            "1103",
            "1104",
            "1105",
            "1106",
            "1107",
            "1108",
            "1109",
            "111",
            "1110",
            "1111",
            "1112",
            "1113",
            "112",
            "114",
            "1150",
            "1151",
            "1152",
            "1153",
            "1154",
            "1155",
            "1156",
            "1157",
            "1158",
            "1159",
            "116",
            "1160",
            "1161",
            "118",
            "120",
            "1200",
            "1201",
            "1202",
            "1203",
            "1204",
            "1205",
            "1206",
            "1207",
            "1208",
            "1209",
            "1210",
            "1211",
            "122",
            "123",
            "124",
            "125",
            "126",
            "127",
            "128",
            "129",
            "1300",
            "1301",
            "1302",
            "1303",
            "1304",
            "1305",
            "1306",
            "1307",
            "1308",
            "1309",
            "1310",
            "1311",
            "1312",
            "1313",
            "1314",
            "1315",
            "1400",
            "1401",
            "1402",
            "1403",
            "1404",
            "1405",
            "1406",
            "1407",
            "1408",
            "1409",
            "1410",
            "1411",
            "1412",
            "1413",
            "150",
            "1500",
            "1501",
            "1502",
            "1503",
            "1504",
            "1505",
            "1506",
            "1507",
            "1508",
            "1509",
            "1510",
            "1511",
            "1512",
            "1513",
            "1514",
            "1515",
            "1516",
            "1517",
            "153",
            "155",
            "157",
            "159",
            "1601",
            "1602",
            "1603",
            "1604",
            "1605",
            "1606",
            "1607",
            "1608",
            "1609",
            "161",
            "1610",
            "1611",
            "1612",
            "1613",
            "1614",
            "1615",
            "1616",
            "1617",
            "1618",
            "162",
            "163",
            "164",
            "165",
            "166",
            "168",
            "170",
            "1702",
            "1703",
            "1704",
            "1705",
            "1706",
            "1707",
            "1708",
            "1709",
            "1710",
            "1711",
            "1712",
            "1713",
            "1714",
            "1715",
            "1716",
            "1717",
            "1718",
            "1719",
            "172",
            "174",
            "1752",
            "1753",
            "1754",
            "1755",
            "1756",
            "1757",
            "1758",
            "1759",
            "176",
            "1760",
            "1761",
            "1762",
            "1763",
            "1764",
            "1765",
            "1766",
            "1767",
            "1768",
            "1769",
            "177",
            "1770",
            "1771",
            "1772",
            "1773",
            "1774",
            "1775",
            "1776",
            "1777",
            "1778",
            "1779",
            "178",
            "1780",
            "1781",
            "1782",
            "1783",
            "179",
            "180",
            "1801",
            "1802",
            "1803",
            "1804",
            "1805",
            "1806",
            "1807",
            "1808",
            "1809",
            "181",
            "1810",
            "1811",
            "1812",
            "1813",
            "1814",
            "1815",
            "1816",
            "1817",
            "1818",
            "182",
            "183",
            "191",
            "194",
            "200",
            "2001",
            "2002",
            "2003",
            "2004",
            "2005",
            "2006",
            "2007",
            "2008",
            "2009",
            "201",
            "2010",
            "2011",
            "2012",
            "2013",
            "2014",
            "2015",
            "2016",
            "203",
            "2032",
            "2033",
            "2034",
            "2035",
            "2036",
            "2037",
            "2038",
            "2039",
            "2040",
            "2041",
            "205",
            "2051",
            "2052",
            "2053",
            "2054",
            "2055",
            "2056",
            "207",
            "2070",
            "2071",
            "2072",
            "2073",
            "2074",
            "2075",
            "2076",
            "2077",
            "2078",
            "2079",
            "2080",
            "2081",
            "2082",
            "2083",
            "2084",
            "2085",
            "209",
            "210",
            "2100",
            "2101",
            "2102",
            "2103",
            "2104",
            "2105",
            "2106",
            "2107",
            "2108",
            "2109",
            "211",
            "2110",
            "2111",
            "2112",
            "2113",
            "212",
            "214",
            "2150",
            "2151",
            "2152",
            "2153",
            "2154",
            "2155",
            "2156",
            "2157",
            "2158",
            "2159",
            "216",
            "2160",
            "2161",
            "218",
            "220",
            "2200",
            "2201",
            "2202",
            "2203",
            "2204",
            "2205",
            "2206",
            "2207",
            "2208",
            "2209",
            "2210",
            "2211",
            "222",
            "223",
            "224",
            "225",
            "226",
            "227",
            "228",
            "229",
            "2300",
            "2301",
            "2302",
            "2303",
            "2304",
            "2305",
            "2306",
            "2307",
            "2308",
            "2309",
            "2310",
            "2311",
            "2312",
            "2313",
            "2314",
            "2315",
            "2400",
            "2401",
            "2402",
            "2403",
            "2404",
            "2405",
            "2406",
            "2407",
            "2408",
            "2409",
            "2410",
            "2411",
            "2412",
            "2413",
            "2500",
            "2501",
            "2502",
            "2503",
            "2504",
            "2505",
            "2506",
            "2507",
            "2508",
            "2509",
            "2510",
            "2511",
            "2512",
            "2513",
            "2514",
            "2515",
            "2516",
            "2517",
            "2706",
            "2707",
            "2708",
            "2709",
            "2710",
            "2711",
            "2712",
            "2713",
            "2714",
            "2715",
            "2716",
            "2717",
            "2718",
            "2719",
            "2752",
            "2753",
            "2754",
            "2755",
            "2756",
            "2757",
            "2758",
            "2759",
            "2760",
            "2761",
            "2762",
            "2763",
            "2764",
            "2765",
            "2766",
            "2767",
            "2768",
            "2769",
            "2770",
            "2771",
            "2772",
            "2773",
            "2774",
            "2775",
            "2776",
            "2777",
            "2778",
            "2779",
            "2780",
            "2781",
            "2782",
            "2783",
            "2805",
            "2806",
            "2807",
            "2808",
            "2809",
            "2810",
            "2811",
            "2812",
            "2813",
            "2814",
            "2815",
            "2816",
            "2817",
            "2818",
            "285",
            "287",
            "289",
            "292",
            "294",
            "296",
            "297",
            "298",
            "300",
            "301",
            "303",
            "305",
            "307",
            "309",
            "311",
            "313",
            "315",
            "316",
            "317",
            "318",
            "319",
            "320",
            "321",
            "322",
            "323",
            "324",
            "326",
            "328",
            "330",
            "332",
            "334",
            "336",
            "338",
            "339",
            "340",
            "341",
            "342",
            "343",
            "344",
            "345",
            "346",
            "347",
            "348",
            "391",
            "400",
            "401",
            "403",
            "405",
            "407",
            "409",
            "411",
            "412",
            "413",
            "414",
            "416",
            "418",
            "420",
            "422",
            "424",
            "426",
            "427",
            "428",
            "429",
            "430",
            "431",
            "432",
            "433",
            "491",
            "494",
            "500",
            "501",
            "503",
            "505",
            "507",
            "509",
            "511",
            "512",
            "513",
            "514",
            "515",
            "516",
            "518",
            "520",
            "522",
            "524",
            "526",
            "528",
            "529",
            "530",
            "531",
            "532",
            "533",
            "534",
            "535",
            "536",
            "537",
            "551",
            "581",
            "583",
            "587",
            "589",
            "592",
            "594",
            "596",
            "601",
            "603",
            "605",
            "607",
            "609",
            "610",
            "611",
            "612",
            "613",
            "614",
            "616",
            "618",
            "620",
            "622",
            "624",
            "625",
            "626",
            "627",
            "628",
            "629",
            "630",
            "631",
            "701",
            "703",
            "705",
            "707",
            "709",
            "710",
            "711",
            "712",
            "713",
            "714",
            "716",
            "718",
            "720",
            "722",
            "724",
            "725",
            "726",
            "727",
            "728",
            "729",
            "730",
            "731",
            "732",
            "741",
            "744",
            "746",
            "746",
            "751",
            "753",
            "755",
            "757",
            "758",
            "759",
            "760",
            "761",
            "762",
            "763",
            "764",
            "765",
            "766",
            "767",
            "768",
            "769",
            "770",
            "772",
            "774",
            "776",
            "778",
            "780",
            "781",
            "782",
            "783",
            "784",
            "785",
            "786",
            "790",
            "790",
            "801",
            "803",
            "805",
            "807",
            "809",
            "811",
            "813",
            "815",
            "816",
            "817",
            "818",
            "820",
            "822",
            "824",
            "826",
            "828",
            "830",
            "831",
            "832",
            "833",
            "834",
            "835",
            "836",
            "837",
            "838",
            "839",
            "843",
            "8801",
            "8803",
            "8805",
            "901",
            "903",
            "905",
            "907",
            "909",
            "910",
            "911",
            "912",
            "914",
            "916",
            "918",
            "920",
            "922",
            "923",
            "924",
            "925",
            "926",
            "927",
            "928"
        };

        private IList<Tuple<string, string, int, int>> EmbargoedHours = new Tuple<string, string, int, int>[]
        {
            new Tuple<string, string, int, int>("blue", "inbound", 7, 9),
            new Tuple<string, string, int, int>("blue", "outbound", 16,18),
            new Tuple<string, string, int, int>("red", "inbound", 7, 10),
            new Tuple<string, string, int, int>("red", "inbound", 16, 19),
            new Tuple<string, string, int, int>("red", "outbound", 7, 10),
            new Tuple<string, string, int, int>("red", "outbound", 16, 19),
            new Tuple<string, string, int, int>("orange", "inbound", 7, 10),
            new Tuple<string, string, int, int>("orange", "inbound", 16, 19),
            new Tuple<string, string, int, int>("orange", "outbound", 7, 10),
            new Tuple<string, string, int, int>("orange", "outbound", 16, 19)
        }.ToList();
    }
}
